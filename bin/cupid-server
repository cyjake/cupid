#!/usr/bin/env node

var connect = require('connect')
var exists = require('fs').existsSync
var join = require('path').join
var resolve = require('path').resolve
var error = require('../lib/utils').error
var log = require('../lib/utils').log
var program = require('commander')


var PORT = 3000

program
  .option('-p --port [port]', 'Specify the port to listen on, default to ' + PORT, parseInt, PORT)
  .parse(process.argv)

var dir = program.args[0] || ''
var planet = resolve(process.cwd(), dir)

if (!exists(join(planet, 'planet.json'))) {
  error('cannot find planet folder to serve')
  process.exit(1)
}

var app = connect()
  .use(connect.logger('dev'))
  .use(connect.static(planet))
  .listen(program.port)

log('server', 'listening on ' + program.port)
